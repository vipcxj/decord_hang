import os
from decord import VideoReader, bridge, cpu

frames = [186, 191, 197, 203, 209, 215, 217, 221, 222, 227, 228, 233, 234, 239, 240, 245, 246, 251, 252, 257, 258, 263, 264, 269, 270, 275, 276, 281, 282, 287, 288, 293, 294, 299, 300, 305, 306, 311, 313, 317, 318, 323, 324, 330, 336, 342, 348, 354, 360, 366, 372, 378, 384, 390, 396, 402, 658, 663, 669, 675, 681, 687, 693, 699, 705, 711, 717, 723, 729, 735, 741, 747, 1005, 1010, 1016, 1022, 1028, 1034, 1040, 1046, 1052, 1058, 1064, 1070, 1076, 1082, 1088, 1094, 1314, 1319, 1325, 1331, 1337, 1343, 1349, 1355, 1361, 1367, 1369, 1373, 1374, 1379, 1380, 1385, 1386, 1391, 1392, 1397, 1398, 1403, 1404, 1410, 1416, 1422, 1428, 1434, 1440, 1446, 1452, 1458, 1745, 1750, 1756, 1762, 1768, 1774, 1780, 1786, 1792, 1798, 1804, 1810, 1816, 1822, 1828, 1834, 2146, 2151, 2157, 2163, 2169, 2175, 2181, 2187, 2193, 2199, 2205, 2211, 2217, 2223, 2229, 2235, 2246, 2251, 2257, 2263, 2269, 2275, 2281, 2287, 2293, 2299, 2305, 2311, 2317, 2323, 2329, 2335, 2532, 2537, 2543, 2549, 2555, 2561, 2567, 2573, 2579, 2585, 2591, 2596, 2597, 2601, 2603, 2607, 2609, 2613, 2615, 2619, 2621, 2625, 2631, 2637, 2643, 2649, 2655, 2661, 2667, 2673, 2679, 2682, 2685, 2687, 2693, 2699, 2705, 2711, 2717, 2723, 2729, 2735, 2741, 2747, 2753, 2759, 2765, 2771, 2885, 2890, 2896, 2902, 2908, 2914, 2920, 2926, 2932, 2938, 2944, 2950, 2956, 2962, 2968, 2974, 3010, 3015, 3021, 3027, 3033, 3039, 3045, 3051, 3057, 3063, 3069, 3075, 3081, 3087, 3093, 3099, 3105, 3110, 3116, 3122, 3128, 3134, 3140, 3146, 3152, 3158, 3164, 3170, 3176, 3182, 3188, 3194, 3247, 3252, 3258, 3264, 3270, 3276, 3282, 3288, 3294, 3300, 3306, 3312, 3318, 3324, 3330, 3336, 3486, 3491, 3497, 3503, 3509, 3515, 3521, 3527, 3533, 3539, 3545, 3551, 3557, 3563, 3569, 3575, 3806, 3811, 3817, 3823, 3829, 3830, 3835, 3841, 3847, 3853, 3859, 3865, 3871, 3877, 3883, 3889, 3895, 3901, 3907, 3913, 3919, 3935, 3940, 3946, 3952, 3958, 3964, 3970, 3976, 3982, 3988, 3993, 3994, 3998, 4000, 4004, 4006, 4010, 4012, 4016, 4018, 4022, 4024, 4028, 4034, 4040, 4046, 4052, 4058, 4060, 4064, 4065, 4070, 4071, 4075, 4076, 4077, 4080, 4082, 4083, 4086, 4089, 4092, 4095, 4098, 4101, 4104, 4107, 4110, 4113, 4116, 4119, 4122, 4125, 4128, 4131, 4134, 4137, 4140, 4143, 4146, 4149, 4152, 4158, 4160, 4164, 4165, 4171, 4177, 4183, 4189, 4195, 4201, 4207, 4213, 4219, 4225, 4231, 4237, 4243, 4249, 4310, 4315, 4321, 4327, 4333, 4339, 4345, 4351, 4357, 4363, 4369, 4375, 4381, 4387, 4393, 4399]

vr = VideoReader(os.path.join(os.path.dirname(__file__),'0063.mp4'), num_threads=1, ctx=cpu(0))
print(len(vr))
error_frames = frames[395:405]
print('check from [a, b) where b < 405')
vr.get_batch(frames[0:404]) # not hang
vr.get_batch(frames[1:404]) # not hang
# ...
vr.get_batch(frames[402:404]) # not hang
vr.get_batch(frames[403:404]) # not hang

print('check from [a, end) where a > 395')
vr.get_batch(frames[396:]) # not hang
vr.get_batch(frames[397:]) # not hang
# ...
vr.get_batch(frames[404:]) # not hang

print('check from [a, b) where a <= 395 and b >= 405')
vr.get_batch(frames[0:405]) # hang
print('we will never reach here!')
vr.get_batch(frames[0:406]) # hang
print('we will never reach here!')
# ...
vr.get_batch(frames[0:]) # hang
print('we will never reach here!')
vr.get_batch(frames[1:]) # hang
print('we will never reach here!')
# ...
vr.get_batch(frames[395:]) # hang
print('we will never reach here!')
